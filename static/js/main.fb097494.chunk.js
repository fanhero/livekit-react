(this["webpackJsonplivekit-react-example"]=this["webpackJsonplivekit-react-example"]||[]).push([[0],{146:function(e,t,n){"use strict";n.r(t);n(86);var a=n(0),r=n.n(a),i=n(59),c=n.n(i),o=(n(91),n(44)),s=n(8),l=n(36),u=n(12),d=n(5),v=n.n(d),p=n(11),m=n(2),h=n(37),b=n(80),f=n(82),j=n(81),g=function(e){var t=e.track,n=e.isLocal,r=Object(a.useRef)();return Object(a.useEffect)((function(){if(!n)return r.current=t.attach(),t.sid&&r.current.setAttribute("data-audio-track-id",t.sid),function(){return t.detach().forEach((function(e){return e.remove()}))}}),[t,n]),null},k={video:"_2WNzJ",participant:"_34YL4",speaker:"_1y2fW",placeholder:"_30KSQ",participantBar:"_2LCHl",name:"_55u8f",center:"_213aF",stats:"_te685",screenShare:"_1FIqv",iconRed:"_3LzZj",controlsWrapper:"_2kKks",buttonWrapper:"_3w3nM",button:"_hRq5k",icon:"_1Nxni",dangerButton:"_Rt0RH",dropdown:"_3Lz0y",hasDropdown:"_3Bgvz",separator:"_1VLMM",popoverMenu:"_3XXS4",list:"_dKNN7",container:"_14898",overlay:"_17KXW",unmuteButton:"_3QhLc"},E=function(e){var t=e.label,n=e.disabled,i=e.onClick,c=e.icon,o=e.className,s=e.menuItems,l=e.popoverContainerClassName,u=e.popoverTriggerBtnClassName,d=e.popoverTriggerBtnSeparatorClassName,v=e.onMenuItemClick,m=Object(a.useState)(!1),f=m[0],j=m[1],g=k.button;o&&(g+=" "+o);var E,O=r.a.createElement("div",null);return s&&s.length>0&&(g+=" "+k.hasDropdown,E=r.a.createElement("button",{disabled:n,className:k.button+" "+u+"  "+k.dropdown,onClick:function(){return j(!f)}},r.a.createElement("div",{className:k.separator+" "+d}),r.a.createElement(h.a,{height:32,icon:p.b})),O=r.a.createElement("div",{className:k.popoverMenu+" "+l},r.a.createElement("ul",{className:k.list},null===s||void 0===s?void 0:s.map((function(e,t){return r.a.createElement("li",{key:t,onClick:function(){return function(e){j(!1),v&&v(e)}(e)}},e.label)}))))),r.a.createElement(b.Popover,{isOpen:f,positions:["top"],content:O},r.a.createElement("div",{className:k.buttonWrapper},r.a.createElement("button",{disabled:n,className:g,onClick:function(){j(!1),i&&i()}},c&&r.a.createElement(h.a,{className:k.icon,height:32,icon:c}),t),E))},O=function(e){var t=e.isMuted,n=e.onClick,i=e.onSourceSelected,c=e.muteText,o=void 0===c?"Mute":c,s=e.unmuteText,l=void 0===s?"Unmute":s,u=e.className,d=e.popoverContainerClassName,v=e.popoverTriggerBtnClassName,h=e.popoverTriggerBtnSeparatorClassName,b=Object(a.useState)([]),f=b[0],j=b[1],g=Object(a.useState)([]),k=g[0],O=g[1],S=Object(a.useCallback)((function(){try{return Promise.resolve(m.Room.getLocalDevices("audioinput")).then((function(e){j(e),O(e.map((function(e){return{label:e.label}})))}))}catch(e){return Promise.reject(e)}}),[]);Object(a.useEffect)((function(){return S(),navigator.mediaDevices.addEventListener("devicechange",S),function(){navigator.mediaDevices.removeEventListener("devicechange",S)}}),[]);return r.a.createElement(E,{label:t?l:o,icon:t?p.e:p.d,onClick:n,menuItems:k,onMenuItemClick:function(e){var t=f.find((function(t){return t.label===e.label}));t&&i&&i(t)},className:u,popoverContainerClassName:d,popoverTriggerBtnClassName:v,popoverTriggerBtnSeparatorClassName:h})};function S(e){var t,n=Object(a.useState)(!1),r=n[0],i=n[1],c=Object(a.useState)(!1)[1],o=Object(a.useState)(e.connectionQuality),s=o[0],l=o[1],u=Object(a.useState)(!1),d=u[0],v=u[1],p=Object(a.useState)(),h=p[0],b=p[1],f=Object(a.useState)([]),j=f[0],g=f[1],k=Object(a.useState)([]),E=k[0],O=k[1],S=function(){g(Array.from(e.tracks.values())),O(Array.from(e.tracks.values()).filter((function(e){return e.isSubscribed&&void 0!==e.track})))};return Object(a.useEffect)((function(){var t=function(e){e.kind===m.Track.Kind.Audio?i(!0):e.kind===m.Track.Kind.Video&&c(!0)},n=function(e){e.kind===m.Track.Kind.Audio?i(!1):e.kind===m.Track.Kind.Video&&c(!1)},a=function(){e.metadata&&b(e.metadata)},r=function(){v(e.isSpeaking)},o=function(){l(e.connectionQuality)};return e.on(m.ParticipantEvent.TrackMuted,t).on(m.ParticipantEvent.TrackUnmuted,n).on(m.ParticipantEvent.ParticipantMetadataChanged,a).on(m.ParticipantEvent.IsSpeakingChanged,r).on(m.ParticipantEvent.TrackPublished,S).on(m.ParticipantEvent.TrackUnpublished,S).on(m.ParticipantEvent.TrackSubscribed,S).on(m.ParticipantEvent.TrackUnsubscribed,S).on(m.ParticipantEvent.LocalTrackPublished,S).on(m.ParticipantEvent.LocalTrackUnpublished,S).on(m.ParticipantEvent.ConnectionQualityChanged,o),a(),r(),S(),function(){e.off(m.ParticipantEvent.TrackMuted,t).off(m.ParticipantEvent.TrackUnmuted,n).off(m.ParticipantEvent.ParticipantMetadataChanged,a).off(m.ParticipantEvent.IsSpeakingChanged,r).off(m.ParticipantEvent.TrackPublished,S).off(m.ParticipantEvent.TrackUnpublished,S).off(m.ParticipantEvent.TrackSubscribed,S).off(m.ParticipantEvent.TrackUnsubscribed,S).off(m.ParticipantEvent.LocalTrackPublished,S).off(m.ParticipantEvent.LocalTrackUnpublished,S).off(m.ParticipantEvent.ConnectionQualityChanged,o)}}),[e]),e.audioTracks.forEach((function(e){t=e.isMuted})),void 0===t&&(t=!0),r!==t&&i(t),{isLocal:e instanceof m.LocalParticipant,isSpeaking:d,connectionQuality:s,publications:j,subscribedTracks:E,cameraPublication:e.getTrack(m.Track.Source.Camera),microphonePublication:e.getTrack(m.Track.Source.Microphone),screenSharePublication:e.getTrack(m.Track.Source.ScreenShare),metadata:h}}var y,x,C,T,w,N=function(e){var t=e.isEnabled,n=e.onClick,i=e.onSourceSelected,c=e.disableText,o=void 0===c?"Disable Video":c,s=e.enableText,l=void 0===s?"Enable Video":s,u=e.className,d=e.popoverContainerClassName,v=e.popoverTriggerBtnClassName,h=e.popoverTriggerBtnSeparatorClassName,b=Object(a.useState)([]),f=b[0],j=b[1],g=Object(a.useState)([]),k=g[0],O=g[1],S=Object(a.useCallback)((function(){try{return Promise.resolve(m.Room.getLocalDevices("videoinput")).then((function(e){j(e),O(e.map((function(e){return{label:e.label}})))}))}catch(e){return Promise.reject(e)}}),[]);Object(a.useEffect)((function(){return S(),navigator.mediaDevices.addEventListener("devicechange",S),function(){navigator.mediaDevices.removeEventListener("devicechange",S)}}),[]);return r.a.createElement(E,{label:t?o:l,icon:t?p.j:p.k,onClick:n,menuItems:k,onMenuItemClick:function(e){var t=f.find((function(t){return t.label===e.label}));t&&i&&i(t)},className:u,popoverContainerClassName:d,popoverTriggerBtnClassName:v,popoverTriggerBtnSeparatorClassName:h})},P=function(e){var t,n,a,i=e.room,c=e.enableScreenShare,o=e.enableAudio,s=e.enableVideo,l=e.onLeave,u=S(i.localParticipant).cameraPublication;if(void 0===c&&(c=!0),void 0===s&&(s=!0),void 0===o&&(o=!0),o){var d=i.localParticipant.isMicrophoneEnabled;t=r.a.createElement(O,{isMuted:!d,onClick:function(){return i.localParticipant.setMicrophoneEnabled(!d)},onSourceSelected:function(e){return i.switchActiveDevice("audioinput",e.deviceId)}})}if(s){var v,m=!(null==(v=null===u||void 0===u?void 0:u.isMuted)||v);n=r.a.createElement(N,{isEnabled:m,onClick:function(){return i.localParticipant.setCameraEnabled(!m)},onSourceSelected:function(e){i.switchActiveDevice("videoinput",e.deviceId)}})}if(c){var h=i.localParticipant.isScreenShareEnabled;a=r.a.createElement(E,{label:h?"Stop sharing":"Share screen",icon:h?p.g:p.c,onClick:function(){h?i.localParticipant.setScreenShareEnabled(!1):i.localParticipant.setScreenShareEnabled(!0)}})}return r.a.createElement("div",{className:k.controlsWrapper},t,n,a,l&&r.a.createElement(E,{label:"End",className:k.dangerButton,onClick:function(){i.disconnect(),l(i)}}))},L=r.a.createContext({stageLayout:"grid",showStats:!1});function M(){return M=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},M.apply(this,arguments)}function R(e){return Object(a.createElement)("svg",M({width:9,height:9,fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),y||(y=Object(a.createElement)("path",{d:"M0 6h2v3H0V6z",fill:"#981010"})),x||(x=Object(a.createElement)("path",{d:"M3.5 3h2v6h-2V3zM7 0h2v9H7V0z",fill:"#1A1B1D"})))}function I(){return I=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},I.apply(this,arguments)}function _(e){return Object(a.createElement)("svg",I({width:9,height:9,fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),C||(C=Object(a.createElement)("path",{d:"M0 6h2v3H0V6zM3.5 3h2v6h-2V3z",fill:"#F89C13"})),T||(T=Object(a.createElement)("path",{d:"M7 0h2v9H7V0z",fill:"#1A1B1D"})))}function A(){return A=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},A.apply(this,arguments)}function D(e){return Object(a.createElement)("svg",A({width:9,height:9,fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),w||(w=Object(a.createElement)("path",{d:"M0 6h2v3H0V6zM3.5 3h2v6h-2V3zM7 0h2v9H7V0z",fill:"#28994E"})))}var B=function(e){var t,n=e.track,i=e.isLocal,c=e.objectFit,o=e.className,s=e.onSizeChanged,l=e.width,u=e.height,d=Object(a.useRef)(null);Object(a.useEffect)((function(){var e=d.current;if(e)return e.muted=!0,n.attach(e),function(){n.detach(e)}}),[n,d]);var v=Object(a.useCallback)((function(e){e.target instanceof HTMLVideoElement&&s&&s(e.target.videoWidth,e.target.videoHeight)}),[]);Object(a.useEffect)((function(){var e=d.current;return e&&e.addEventListener("resize",v),function(){null===e||void 0===e||e.removeEventListener("resize",v)}}),[d]);var p="environment"!==(null===(t=n.mediaStreamTrack)||void 0===t?void 0:t.getSettings().facingMode),m={transform:i&&p?"rotateY(180deg)":"",width:l,height:u};return c&&(m.objectFit=c),r.a.createElement("video",{ref:d,className:null!=o?o:k.video,style:m})},z=function(e){var t=e.participant,n=e.width,i=e.height,c=e.className,o=e.speakerClassName,s=e.aspectWidth,l=e.aspectHeight,u=e.orientation,d=e.displayName,v=e.showOverlay,b=e.showConnectionQuality,j=e.onMouseEnter,g=e.onMouseLeave,E=e.onClick,O=S(t),y=O.cameraPublication,x=O.isLocal,C=O.connectionQuality,T=O.isSpeaking,w=Object(a.useState)(),N=w[0],P=w[1],M=Object(a.useState)(),I=M[0],A=M[1],z=Object(a.useContext)(L),V=Object(a.useCallback)((function(e,t){P(e+"x"+t)}),[]);Object(a.useEffect)((function(){var e=setInterval((function(){var e=0;t.tracks.forEach((function(t){(t.track instanceof m.LocalTrack||t.track instanceof m.RemoteTrack)&&(e+=t.track.currentBitrate)})),A(e)}),1e3);return function(){clearInterval(e)}}),[]);var U,Q,H={width:n,height:i},K="contain";!u&&s&&l&&(u=s>l?"landscape":"portrait"),null!==y&&void 0!==y&&y.dimensions&&(U=y.dimensions.width>y.dimensions.height?"landscape":"portrait"),U===u&&(K="cover"),d||(d=t.name||t.identity,x&&(d+=" (You)")),Q=null===y||void 0===y||!y.isSubscribed||null===y||void 0===y||!y.track||null!==y&&void 0!==y&&y.isMuted?r.a.createElement("div",{className:k.placeholder}):r.a.createElement(B,{track:y.track,isLocal:x,objectFit:K,width:"100%",height:"100%",onSizeChanged:V});var W=[k.participant];c&&W.push(c),T&&W.push(null!=o?o:k.speaker);var F,X,q=!t.isMicrophoneEnabled;if(z.showStats&&(F=r.a.createElement("div",{className:k.stats},r.a.createElement("div",null,N),void 0!==I&&I>0&&r.a.createElement("div",null,Math.round(I/1024)," kbps"))),b)switch(C){case m.ConnectionQuality.Excellent:X=D;break;case m.ConnectionQuality.Good:X=_;break;case m.ConnectionQuality.Poor:X=R}return r.a.createElement("div",{className:W.join(" "),style:H,onMouseEnter:j,onMouseLeave:g,onClick:E},s&&l&&r.a.createElement(f.AspectRatio,{ratio:s/l},Q),(!s||!l)&&Q,(v||z.showStats)&&r.a.createElement("div",{className:k.participantBar},r.a.createElement("div",{className:k.name},d),r.a.createElement("div",{className:k.center},F),r.a.createElement("div",null,X&&r.a.createElement(X,null)),r.a.createElement("div",null,r.a.createElement(h.a,{icon:q?p.e:p.d,height:24,className:q?k.iconRed:k.iconNormal}))))},V=function(e){var t=e.track,n=e.width,a=e.height;return r.a.createElement("div",{className:k.screenShare},r.a.createElement(B,{track:t,isLocal:!1,width:n,height:a}))};function U(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function Q(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"===typeof e)return U(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?U(e,t):void 0}}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var a=0;return function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var H="_2sm4e",K="_2VE66",W="_2kKDi",F="_gA0MQ",X="_1smc2",q="_2HbZ0",G="_2ltyS",J="_2vumQ",Y="_X-1Rk",Z="_3rLR0",$="_3qF9s",ee=function(e){var t=e.roomState,n=e.participantRenderer,i=e.controlRenderer,c=e.onLeave,o=t.isConnecting,s=t.error,l=t.participants,u=t.room,d=Object(a.useState)([]),v=d[0],p=d[1],m=Object(a.useState)(!1),h=m[0],b=m[1],f=r.a.useState(G),j=f[0],g=f[1];if(Object(a.useEffect)((function(){var e,t=1;1===l.length?g(G):2===l.length?(g(J),t=2):l.length<=4?(g(Y),t=Math.min(l.length,4)):l.length<=9?(g(Z),t=Math.min(l.length,9)):l.length<=16?(g($),t=Math.min(l.length,16)):(g($),t=Math.min(l.length,25));var n=[];v.forEach((function(e){(null!==u&&void 0!==u&&u.participants.has(e.sid)||(null===u||void 0===u?void 0:u.localParticipant.sid)===e.sid)&&n.push(e)})),null===u||void 0===u||null===(e=u.activeSpeakers)||void 0===e||e.forEach((function(e){if(!n.includes(e)&&(e===(null===u||void 0===u?void 0:u.localParticipant)||null!==u&&void 0!==u&&u.participants.has(e.sid))){var t=n.findIndex((function(e){return!e.isSpeaking}));t>=0?n[t]=e:n.push(e)}}));for(var a,r=Q(l);!(a=r()).done;){var i=a.value;if(n.length>=t)break;n.includes(i)||i.isSpeaking||n.push(i)}n.length>t&&n.splice(t,n.length-t),p(n)}),[l]),s)return r.a.createElement("div",null,"error ",s.message);if(o)return r.a.createElement("div",null,"connecting");if(!u)return r.a.createElement("div",null,"room closed");if(0===l.length)return r.a.createElement("div",null,"no one is in the room");var k=null!=n?n:z,E=null!=i?i:P;return r.a.createElement("div",{className:H},r.a.createElement("div",{className:q+" "+j},v.map((function(e){return r.a.createElement(k,{key:e.identity,participant:e,orientation:"landscape",width:"100%",height:"100%",showOverlay:h,showConnectionQuality:!0,onMouseEnter:function(){return b(!0)},onMouseLeave:function(){return b(!1)}})}))),r.a.createElement("div",{className:X},r.a.createElement(E,{room:u,onLeave:c})))},te=function(e){var t=e.roomState,n=e.participantRenderer,i=e.controlRenderer,c=e.onLeave,o=t.isConnecting,s=t.error,l=t.participants,u=t.room,d=Object(a.useState)(!1),v=d[0],p=d[1];if(s)return r.a.createElement("div",null,"error ",s.message);if(o)return r.a.createElement("div",null,"connecting");if(!u)return r.a.createElement("div",null,"room closed");if(0===l.length)return r.a.createElement("div",null,"no one is in the room");var h,b=null!=n?n:z,f=null!=i?i:P;l.forEach((function(e){if(!h){var t=e.getTrack(m.Track.Source.ScreenShare);null!==t&&void 0!==t&&t.isSubscribed&&t.videoTrack&&(h=t.videoTrack)}}));var j,g=l;return j=h?r.a.createElement(V,{track:h,height:"100%",width:"100%"}):r.a.createElement(b,{key:l[0].identity,participant:l[0],width:"100%",height:"100%",orientation:"landscape",showOverlay:v,showConnectionQuality:!0,onMouseEnter:function(){return p(!0)},onMouseLeave:function(){return p(!1)}}),r.a.createElement("div",{className:H},r.a.createElement("div",{className:K},r.a.createElement("div",{className:W},j),r.a.createElement("div",{className:F},g.map((function(e){return r.a.createElement(b,{key:e.identity,participant:e,width:"100%",aspectWidth:16,aspectHeight:9,showOverlay:v,onMouseEnter:function(){return p(!0)},onMouseLeave:function(){return p(!1)}})})))),r.a.createElement("div",{className:X},r.a.createElement(f,{room:u,onLeave:c})))},ne="_2zM8F",ae="_9PXrI",re="_Tl5ht",ie="_jGXiG",ce="_3MB5b",oe=function(e){var t=e.roomState,n=e.participantRenderer,i=e.controlRenderer,c=e.onLeave,o=t.isConnecting,s=t.error,l=t.participants,u=t.room,d=Object(a.useState)(!1),v=d[0],p=d[1];if(s)return r.a.createElement("div",null,"error ",s.message);if(o)return r.a.createElement("div",null,"connecting");if(!u)return r.a.createElement("div",null,"room closed");if(0===l.length)return r.a.createElement("div",null,"no one is in the room");var h,b=null!=n?n:z,f=null!=i?i:P;l.forEach((function(e){if(!h){var t=e.getTrack(m.Track.Source.ScreenShare);null!==t&&void 0!==t&&t.isSubscribed&&t.videoTrack&&(h=t.videoTrack)}}));var j,g=l;return j=h?r.a.createElement(V,{track:h,height:"100%",width:"100%"}):r.a.createElement(b,{key:l[0].identity,participant:l[0],showOverlay:v,width:"100%",height:"100%",orientation:"portrait",showConnectionQuality:!0,onMouseEnter:function(){return p(!0)},onMouseLeave:function(){return p(!1)}}),r.a.createElement("div",{className:ne},r.a.createElement("div",{className:ae},j),r.a.createElement("div",{className:re},g.map((function(e){return r.a.createElement(b,{key:e.identity,participant:e,className:ie,aspectWidth:4,aspectHeight:3,showOverlay:v,onMouseEnter:function(){return p(!0)},onMouseLeave:function(){return p(!1)}})}))),r.a.createElement("div",{className:ce},r.a.createElement(f,{room:u,enableScreenShare:!1,onLeave:c})))},se=function(e){var t,n,i=Object(j.useMediaQuery)({query:"(max-width: 800px)"}),c=e.roomState,o=c.room,s=c.participants,l=Object(a.useContext)(L);i?t=r.a.createElement(oe,Object.assign({},e)):(s.forEach((function(e){if(!n){var t=e.getTrack(m.Track.Source.ScreenShare);null!==t&&void 0!==t&&t.isSubscribed&&t.videoTrack&&(n=t.videoTrack)}})),t="grid"===l.stageLayout&&void 0===n?r.a.createElement(ee,Object.assign({},e)):r.a.createElement(te,Object.assign({},e)));return r.a.createElement("div",{className:k.container},t,e.roomState.audioTracks.map((function(e){return r.a.createElement(g,{key:e.sid,track:e,isLocal:!1})})),!1===(null===o||void 0===o?void 0:o.canPlaybackAudio)&&r.a.createElement("div",{className:k.overlay},r.a.createElement("button",{className:k.unmuteButton,onClick:function(){o.startAudio()}},r.a.createElement(h.a,{className:k.icon,size:"1x",icon:p.l}),"Click to Unmute")))};"undefined"!==typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"!==typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));function le(e,t){if(e.sort((function(e,t){var n,a,r,i;if(e.isSpeaking&&t.isSpeaking)return t.audioLevel-e.audioLevel;if(e.isSpeaking!==t.isSpeaking)return e.isSpeaking?-1:1;if(e.lastSpokeAt!==t.lastSpokeAt){var c,o,s,l,u=null!=(c=null===(o=e.lastSpokeAt)||void 0===o?void 0:o.getTime())?c:0;return(null!=(s=null===(l=t.lastSpokeAt)||void 0===l?void 0:l.getTime())?s:0)-u}var d=e.videoTracks.size>0;return d!==t.videoTracks.size>0?d?-1:1:(null!=(n=null===(a=e.joinedAt)||void 0===a?void 0:a.getTime())?n:0)-(null!=(r=null===(i=t.joinedAt)||void 0===i?void 0:i.getTime())?r:0)})),t){var n=e.indexOf(t);n>=0&&(e.splice(n,1),e.length>0?e.splice(1,0,t):e.push(t))}}var ue=function(e){var t=e.url,n=e.token,r=e.connectOptions,i=e.sortParticipants,c=e.stageRenderer,o=e.participantRenderer,s=e.controlRenderer,l=e.onConnected,u=e.onLeave,d=function(e){var t,n=Object(a.useState)(),r=n[0],i=n[1],c=Object(a.useState)(!1),o=c[0],s=c[1],l=Object(a.useState)(),u=l[0],d=l[1],v=Object(a.useState)([]),p=v[0],h=v[1],b=Object(a.useState)([]),f=b[0],j=b[1],g=null!=(t=null===e||void 0===e?void 0:e.sortParticipants)?t:le,k=Object(a.useCallback)((function(e,t,n){try{return s(!0),Promise.resolve(function(e,t){try{var n=e()}catch(a){return t(a)}return n&&n.then?n.then(void 0,t):n}((function(){return Promise.resolve(Object(m.connect)(e,t,n)).then((function(e){i(e);var t=function(){var t=Array.from(e.participants.values()),n=[e.localParticipant];n.push.apply(n,t),g(n,e.localParticipant),h(n)},n=function(n){if(t(),!n||n.kind===m.Track.Kind.Audio){var a=[];e.participants.forEach((function(e){e.audioTracks.forEach((function(e){e.audioTrack&&a.push(e.audioTrack)}))})),j(a)}};return e.once(m.RoomEvent.Disconnected,(function(){setTimeout((function(){return i(void 0)})),e.off(m.RoomEvent.ParticipantConnected,t).off(m.RoomEvent.ParticipantDisconnected,t).off(m.RoomEvent.ActiveSpeakersChanged,t).off(m.RoomEvent.TrackSubscribed,n).off(m.RoomEvent.TrackUnsubscribed,n).off(m.RoomEvent.LocalTrackPublished,n).off(m.RoomEvent.LocalTrackUnpublished,n).off(m.RoomEvent.AudioPlaybackStatusChanged,t)})),e.on(m.RoomEvent.ParticipantConnected,t).on(m.RoomEvent.ParticipantDisconnected,t).on(m.RoomEvent.ActiveSpeakersChanged,t).on(m.RoomEvent.TrackSubscribed,n).on(m.RoomEvent.TrackUnsubscribed,n).on(m.RoomEvent.LocalTrackPublished,n).on(m.RoomEvent.LocalTrackUnpublished,n).on(m.RoomEvent.AudioPlaybackStatusChanged,t),s(!1),n(),e}))}),(function(e){s(!1),e instanceof Error?d(e):d(new Error("an error has occured"))})))}catch(a){return Promise.reject(a)}}),[]);return{connect:k,isConnecting:o,room:r,error:u,participants:p,audioTracks:f}}({sortParticipants:i});return r||(r={}),Object(a.useEffect)((function(){d.connect(t,n,r).then((function(e){if(e)return l&&l(e),function(){e.disconnect()}}))}),[]),(null!=c?c:se)({roomState:d,participantRenderer:o,controlRenderer:s,onLeave:u})},de=n(85),ve=n(1),pe=function(){var e=Object(a.useState)("ws://localhost:7880"),t=Object(u.a)(e,2),n=t[0],r=t[1],i=Object(a.useState)(""),c=Object(u.a)(i,2),o=c[0],d=c[1],h=Object(a.useState)(!0),b=Object(u.a)(h,2),f=b[0],j=b[1],g=Object(a.useState)(!0),k=Object(u.a)(g,2),S=k[0],y=k[1],x=Object(a.useState)(!0),C=Object(u.a)(x,2),T=C[0],w=C[1],P=Object(a.useState)(!1),L=Object(u.a)(P,2),M=L[0],R=L[1],I=Object(a.useState)(!0),_=Object(u.a)(I,2),A=_[0],D=_[1],z=Object(a.useState)(!0),V=Object(u.a)(z,2),U=V[0],Q=V[1],H=Object(a.useState)(),K=Object(u.a)(H,2),W=K[0],F=K[1],X=Object(a.useState)(),q=Object(u.a)(X,2),G=q[0],J=q[1],Y=Object(a.useState)(),Z=Object(u.a)(Y,2),$=Z[0],ee=Z[1],te=Object(s.f)();Object(a.useEffect)((function(){Q(!o||!n)}),[o,n]);var ne=function(){var e=Object(l.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!W){e.next=6;break}W.stop(),R(!1),F(void 0),e.next=11;break;case 6:return e.next=8,Object(m.createLocalVideoTrack)({deviceId:null===$||void 0===$?void 0:$.deviceId});case 8:t=e.sent,R(!0),F(t);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(a.useEffect)((function(){Object(m.createLocalVideoTrack)({deviceId:null===$||void 0===$?void 0:$.deviceId}).then((function(e){R(!0),F(e)}))}),[$]);var ae,re=function(){var e=Object(l.a)(v.a.mark((function e(){var t,a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(W&&W.stop(),"https:"!==window.location.protocol||!n.startsWith("ws://")||n.startsWith("ws://localhost")){e.next=4;break}return alert("Unable to connect to insecure websocket from https"),e.abrupt("return");case 4:if(t={url:n,token:o,videoEnabled:M?"1":"0",audioEnabled:A?"1":"0",simulcast:f?"1":"0",dynacast:S?"1":"0",adaptiveStream:T?"1":"0"},G&&(t.audioDeviceId=G.deviceId),!$){e.next=10;break}t.videoDeviceId=$.deviceId,e.next=15;break;case 10:if(!W){e.next=15;break}return e.next=13,W.getDeviceId();case 13:(a=e.sent)&&(t.videoDeviceId=a);case 15:te.push({pathname:"/room",search:"?"+new URLSearchParams(t).toString()});case 16:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return ae=W?Object(ve.jsx)(B,{track:W,isLocal:!0}):Object(ve.jsx)("div",{className:"placeholder"}),Object(ve.jsxs)("div",{className:"prejoin",children:[Object(ve.jsxs)("main",{children:[Object(ve.jsx)("h2",{children:"LiveKit Video"}),Object(ve.jsx)("hr",{}),Object(ve.jsxs)("div",{className:"entrySection",children:[Object(ve.jsxs)("div",{children:[Object(ve.jsx)("div",{className:"label",children:"LiveKit URL"}),Object(ve.jsx)("div",{children:Object(ve.jsx)("input",{type:"text",name:"url",value:n,onChange:function(e){return r(e.target.value)}})})]}),Object(ve.jsxs)("div",{children:[Object(ve.jsx)("div",{className:"label",children:"Token"}),Object(ve.jsx)("div",{children:Object(ve.jsx)("input",{type:"text",name:"token",value:o,onChange:function(e){return d(e.target.value)}})})]}),Object(ve.jsxs)("div",{className:"options",children:[Object(ve.jsxs)("div",{children:[Object(ve.jsx)("input",{id:"simulcast-option",type:"checkbox",name:"simulcast",checked:f,onChange:function(e){return j(e.target.checked)}}),Object(ve.jsx)("label",{htmlFor:"simulcast-option",children:"Simulcast"})]}),Object(ve.jsxs)("div",{children:[Object(ve.jsx)("input",{id:"dynacast-option",type:"checkbox",name:"dynacast",checked:S,onChange:function(e){return y(e.target.checked)}}),Object(ve.jsx)("label",{htmlFor:"dynacast-option",children:"Dynacast"})]}),Object(ve.jsxs)("div",{children:[Object(ve.jsx)("input",{id:"adaptivestream-option",type:"checkbox",name:"adaptiveStream",checked:T,onChange:function(e){return w(e.target.checked)}}),Object(ve.jsx)("label",{htmlFor:"adaptivestream-option",children:"Adaptive Stream"})]})]})]}),Object(ve.jsx)("div",{className:"videoSection",children:Object(ve.jsx)(de.AspectRatio,{ratio:16/9,children:ae})}),Object(ve.jsxs)("div",{className:"controlSection",children:[Object(ve.jsxs)("div",{children:[Object(ve.jsx)(O,{isMuted:!A,onClick:function(){D(!A)},onSourceSelected:J}),Object(ve.jsx)(N,{isEnabled:void 0!==W,onClick:ne,onSourceSelected:function(e){if(ee(e),W){if(W.mediaStreamTrack.getSettings().deviceId===e.deviceId)return;W.stop()}}})]}),Object(ve.jsx)("div",{className:"right",children:Object(ve.jsx)(E,{label:"Connect",disabled:U,icon:p.a,onClick:re})})]})]}),Object(ve.jsxs)("footer",{children:["This page is built with ",Object(ve.jsx)("a",{href:"https://github.com/livekit/livekit-react",children:"LiveKit React"}),"\xa0 (",Object(ve.jsx)("a",{href:"https://github.com/livekit/livekit-react/blob/master/example/src/PreJoinPage.tsx",children:"source"}),")"]})]})},me=n(61),he=n(46),be=(n(144),function(){var e=Object(a.useState)(0),t=Object(u.a)(e,2),n=t[0],r=t[1],i=Object(a.useState)({stageLayout:"grid",showStats:!1}),c=Object(u.a)(i,2),o=c[0],l=c[1],d=Object(s.f)(),v=new URLSearchParams(Object(s.g)().search),h=v.get("url"),b=v.get("token"),f=v.get("recorder");if(!h||!b)return Object(ve.jsx)("div",{children:"url and token are required"});var j=function(e){r(e.participants.size+1)},g=function(e){l(Object(me.a)(Object(me.a)({},o),e))};return Object(ve.jsx)(L.Provider,{value:o,children:Object(ve.jsxs)("div",{className:"roomContainer",children:[Object(ve.jsxs)("div",{className:"topBar",children:[Object(ve.jsx)("h2",{children:"LiveKit Video"}),Object(ve.jsxs)("div",{className:"right",children:[Object(ve.jsxs)("div",{children:[Object(ve.jsx)("input",{id:"showStats",type:"checkbox",onChange:function(e){return g({showStats:e.target.checked})}}),Object(ve.jsx)("label",{htmlFor:"showStats",children:"Show Stats"})]}),Object(ve.jsxs)("div",{children:[Object(ve.jsx)("button",{className:"iconButton",disabled:"grid"===o.stageLayout,onClick:function(){g({stageLayout:"grid"})},children:Object(ve.jsx)(he.a,{height:32,icon:p.h})}),Object(ve.jsx)("button",{className:"iconButton",disabled:"speaker"===o.stageLayout,onClick:function(){g({stageLayout:"speaker"})},children:Object(ve.jsx)(he.a,{height:32,icon:p.f})})]}),Object(ve.jsxs)("div",{className:"participantCount",children:[Object(ve.jsx)(he.a,{icon:p.i}),Object(ve.jsx)("span",{children:n})]})]})]}),Object(ve.jsx)(ue,{url:h,token:b,onConnected:function(e){!function(e,t){fe.apply(this,arguments)}(e,v),e.on(m.RoomEvent.ParticipantConnected,(function(){return j(e)})),e.on(m.RoomEvent.ParticipantDisconnected,(function(){return function(e){j(e),f&&1===parseInt(f,10)&&0===e.participants.size&&console.log("END_RECORDING")}(e)})),j(e)},connectOptions:{adaptiveStream:je(v,"adaptiveStream"),dynacast:je(v,"dynacast"),videoCaptureDefaults:{resolution:m.VideoPresets.hd.resolution},publishDefaults:{videoEncoding:m.VideoPresets.hd.encoding,simulcast:je(v,"simulcast")},logLevel:"debug"},onLeave:function(){d.push({pathname:"/"})}})]})})});function fe(){return(fe=Object(l.a)(v.a.mark((function e(t,n){var a,r;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.currentRoom=t,!je(n,"audioEnabled")){e.next=6;break}return(a=n.get("audioDeviceId"))&&t.options.audioCaptureDefaults&&(t.options.audioCaptureDefaults.deviceId=a),e.next=6,t.localParticipant.setMicrophoneEnabled(!0);case 6:if(!je(n,"videoEnabled")){e.next=11;break}return(r=n.get("videoDeviceId"))&&t.options.videoCaptureDefaults&&(t.options.videoCaptureDefaults.deviceId=r),e.next=11,t.localParticipant.setCameraEnabled(!0);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function je(e,t){return"1"===e.get(t)||"true"===e.get(t)}var ge=function(){return Object(ve.jsx)("div",{className:"container",children:Object(ve.jsx)(o.a,{children:Object(ve.jsxs)(s.c,{children:[Object(ve.jsx)(s.a,{path:"/room",children:Object(ve.jsx)(be,{})}),Object(ve.jsx)(s.a,{path:"/",children:Object(ve.jsx)(pe,{})})]})})})};c.a.render(Object(ve.jsx)(ge,{}),document.getElementById("root"))},86:function(e,t,n){},91:function(e,t,n){}},[[146,1,2]]]);
//# sourceMappingURL=main.fb097494.chunk.js.map